#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start calendar2image service
# ==============================================================================

bashio::log.info "Starting Calendar2Image..."

# Home Assistant mounts /config as the main configuration directory
# Use a subdirectory for this add-on's configs
CONFIG_DIR="/config/calendar2image"

mkdir -p "$CONFIG_DIR"
bashio::log.info "Using config directory: $CONFIG_DIR"

# Copy sample files if they don't exist
if [ ! -f "$CONFIG_DIR/sample-0.json" ]; then
    bashio::log.info "Copying sample-0.json..."
    cp /app/sample-0.json "$CONFIG_DIR/sample-0.json"
fi

if [ ! -f "$CONFIG_DIR/README.md" ]; then
    bashio::log.info "Copying README.md..."
    cp /app/config-sample-README.md "$CONFIG_DIR/README.md"
fi

bashio::log.info "Config directory contents:"
ls -la "$CONFIG_DIR/"

# Export CONFIG_DIR for the app to use
export CONFIG_DIR

# Start the Node.js application
cd /app
exec node src/index.js
